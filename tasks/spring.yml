---
- name: Create group for springboot app
  group:
    name: "{{ springboot_group }}"
    state: present

- name: Create user for springboot app
  user:
    name: "{{ springboot_user }}"
    group: "{{ springboot_group }}"
    state: present

- name: Create deploy folder if not exists
  file:
    path: "{{ springboot_deploy_folder }}"
    mode: "0644"
    state: directory
    owner: "{{ springboot_user }}"
    group: "{{ springboot_group }}"

- name: Copy dist archive
  unarchive:
    src: "{{ springboot_dist_file }}"
    dest: /opt
    owner: "{{ springboot_user }}"
    group: "{{ springboot_group }}"
  notify:
    - Restart application

- name: Copy extra files
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "{{ springboot_deploy_folder }}/"
    mode: "0644"
    owner: "{{ springboot_user }}"
    group: "{{ springboot_group }}"
  with_items: "{{ extra_files }}"

- name: Deploy app config
  template:
    src: "{{ springboot_configuration_template }}"
    dest: "{{ springboot_deploy_folder }}/application.yml"
    mode: "0644"
    owner: "{{ springboot_user }}"
    group: "{{ springboot_group }}"
  vars:
    # pass same dummy defaults
    signing_portal_base_path: https://admin.secsigntest.com/rest/signatureportal/v1/
    signing_portal_user: dummy
    signing_portal_password: dummy
    signing_options_companystamptext: Bunge Beratung
    signing_options_sealconfigid: 1
    signing_options_sigpos: dummy object
  notify:
    - Restart application
